
from kivy.lang import Builder
from kivy.uix.widget import Widget
from kivy.graphics import Line, Color, Ellipse, Rectangle
from kivymd.app import MDApp
from kivymd.uix.boxlayout import MDBoxLayout
from kivymd.uix.gridlayout import MDGridLayout
from kivymd.uix.button import MDIconButton, MDRaisedButton
from kivymd.uix.label import MDLabel
from kivymd.uix.textfield import MDTextField

KV = """
BoxLayout:
    orientation: "vertical"
    canvas.before:
        Color:
            rgba: 0.94, 0.91, 0.85, 1  # Updated background color
        Rectangle:
            pos: self.pos
            size: self.size

    MDBoxLayout:
        size_hint_y: 0.1
        padding: 10
        MDLabel:
            text: "Community"
            font_style: "H5"
            halign: "center"
    
    IconGrid:
        size_hint_y: 0.4

    MDBoxLayout:
        size_hint_y: 0.1
        padding: 10
        spacing: 10

        MDTextField:
            id: message_input
            hint_text: "How are you feeling?"
            mode: "rectangle"
            background_color: 1, 1, 1, 1  # White input field

        MDRaisedButton:
            text: "Send"
            on_release: app.send_message()

    MDBoxLayout:
        size_hint_y: 0.1
        padding: 10
        spacing: 20
        MDIconButton:
            icon: "home"
        MDIconButton:
            icon: "chat"
        MDIconButton:
            icon: "chart-bar"
        MDIconButton:
            icon: "account"
"""

class CustomIcon(Widget):
    """Draws a black square with a small overlapping black circle"""
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self.bind(pos=self.update_graphics, size=self.update_graphics)
        self.update_graphics()

    def update_graphics(self, *args):
        self.canvas.clear()
        with self.canvas:
            Color(0, 0, 0, 1)
            size = (30, 30)
            Line(rectangle=(self.x, self.y, size[0], size[1]), width=2)
            Ellipse(pos=(self.x + 30, self.y), size=(10, 10))

class IconGrid(MDGridLayout):
    """Grid layout containing the custom icons"""
    def __init__(self, **kwargs):
        super().__init__(cols=3, rows=2, **kwargs)
        for _ in range(6):
            self.add_widget(CustomIcon())

class KivyAndroidApp(MDApp):
    def build(self):
        return Builder.load_string(KV)

    def send_message(self):
        message = self.root.ids.message_input.text
        if message.strip():
            print(f"User: {message}")  # Simulating a chat message being sent
            self.root.ids.message_input.text = ""  # Clear input field after sending

if __name__ == "__main__":
    KivyAndroidApp().run()
    
